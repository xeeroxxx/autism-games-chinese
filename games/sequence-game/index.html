<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—¥å¸¸æ´»åŠ¨æ’åº - è‡ªé—­ç—‡å„¿ç«¥äº’åŠ¨æ¸¸æˆ</title>
    <style>
        body {
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
            background-color: #f0f8ff;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }
        header {
            background-color: #4a86e8;
            color: white;
            width: 100%;
            padding: 15px 0;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            position: relative;
        }
        h1 {
            margin: 0;
            font-size: 2em;
        }
        .back-button {
            position: absolute;
            left: 20px;
            top: 15px;
            background-color: rgba(255,255,255,0.3);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s;
        }
        .back-button:hover {
            background-color: rgba(255,255,255,0.5);
        }
        .container {
            max-width: 900px;
            margin: 30px auto;
            padding: 0 20px;
            text-align: center;
        }
        .game-info {
            margin-bottom: 30px;
            line-height: 1.6;
        }
        .sequence-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 30px;
            margin-bottom: 30px;
        }
        .activity-selection {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
            padding: 20px;
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .sequence-board {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            max-width: 600px;
        }
        .sequence-step {
            display: flex;
            align-items: center;
            background-color: white;
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .step-number {
            background-color: #4a86e8;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2em;
            font-weight: bold;
            margin-right: 15px;
            flex-shrink: 0;
        }
        .step-content {
            flex-grow: 1;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px dashed #ccc;
            border-radius: 10px;
            padding: 10px;
        }
        .activity-card {
            width: 120px;
            height: 120px;
            background-color: #e6f2ff;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            user-select: none;
        }
        .activity-card:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        .activity-card.selected {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .activity-icon {
            font-size: 3em;
            margin-bottom: 10px;
        }
        .activity-label {
            font-size: 0.9em;
            text-align: center;
            color: #333;
        }
        .controls {
            margin-top: 20px;
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        button {
            background-color: #4a86e8;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #3a76d8;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            align-items: center;
            justify-content: center;
            background-color: rgba(0,0,0,0.7);
            z-index: 100;
        }
        .celebration-content {
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            animation: pop 0.5s;
        }
        @keyframes pop {
            0% { transform: scale(0.5); }
            80% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .celebration h2 {
            color: #4a86e8;
            font-size: 2em;
            margin-bottom: 20px;
        }
        .emoji-rain {
            font-size: 3em;
            margin: 20px 0;
            letter-spacing: 10px;
        }
        @media (max-width: 768px) {
            .activity-card {
                width: 100px;
                height: 100px;
            }
            .activity-icon {
                font-size: 2.5em;
            }
        }
    </style>
</head>
<body>
    <header>
        <button class="back-button" onclick="location.href='../../index.html'">â† è¿”å›</button>
        <h1>æ—¥å¸¸æ´»åŠ¨æ’åº</h1>
    </header>

    <div class="container">
        <div class="game-info">
            <p>å°†æ—¥å¸¸æ´»åŠ¨æŒ‰ç…§æ­£ç¡®çš„é¡ºåºæ’åˆ—ï¼æ‹–åŠ¨ä¸‹æ–¹çš„æ´»åŠ¨å¡ç‰‡åˆ°ä¸Šæ–¹çš„åºåˆ—æ¡†ä¸­ã€‚</p>
        </div>

        <div class="sequence-container">
            <div class="sequence-board" id="sequenceBoard">
                <!-- åºåˆ—æ­¥éª¤å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>

            <div class="activity-selection" id="activitySelection">
                <!-- æ´»åŠ¨å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>

        <div class="controls">
            <button id="checkButton" disabled>æ£€æŸ¥é¡ºåº</button>
            <button id="resetButton">é‡ç½®</button>
            <button id="newActivityButton">æ–°æ´»åŠ¨</button>
        </div>
    </div>

    <div class="celebration" id="celebration">
        <div class="celebration-content">
            <h2>å¤ªæ£’äº†ï¼</h2>
            <p>ä½ æˆåŠŸåœ°å°†æ‰€æœ‰æ´»åŠ¨æŒ‰æ­£ç¡®é¡ºåºæ’åˆ—ï¼</p>
            <div class="emoji-rain">ğŸ‰âœ¨ğŸŒŸğŸ‘</div>
            <button id="nextActivityButton">ä¸‹ä¸€ä¸ªæ´»åŠ¨</button>
        </div>
    </div>

    <script>
        // æ´»åŠ¨æ•°æ®
        const activities = [
            {
                name: "æ—©æ™¨èµ·åºŠ",
                steps: [
                    { icon: "ğŸ›Œ", label: "èµ·åºŠ" },
                    { icon: "ğŸš¿", label: "æ´—æ¾¡" },
                    { icon: "ğŸ¦·", label: "åˆ·ç‰™" },
                    { icon: "ğŸ‘•", label: "ç©¿è¡£æœ" },
                    { icon: "ğŸ³", label: "åƒæ—©é¤" }
                ]
            },
            {
                name: "æ´—æ‰‹æ­¥éª¤",
                steps: [
                    { icon: "ğŸ’§", label: "æ‰“å¼€æ°´é¾™å¤´" },
                    { icon: "ğŸ§¼", label: "ç”¨è‚¥çš‚" },
                    { icon: "ğŸ‘", label: "æ“æ‰‹" },
                    { icon: "ğŸ’¦", label: "å†²æ´—" },
                    { icon: "ğŸ§»", label: "æ“¦å¹²" }
                ]
            },
            {
                name: "å‡†å¤‡ç¡è§‰",
                steps: [
                    { icon: "ğŸ§¸", label: "æ”¶æ‹¾ç©å…·" },
                    { icon: "ğŸ¦·", label: "åˆ·ç‰™" },
                    { icon: "ğŸ‘•", label: "æ¢ç¡è¡£" },
                    { icon: "ğŸ“š", label: "è¯»æ•…äº‹" },
                    { icon: "ğŸ›Œ", label: "ä¸ŠåºŠç¡è§‰" }
                ]
            }
        ];

        // å½“å‰æ´»åŠ¨ç´¢å¼•
        let currentActivityIndex = 0;
        let currentActivity = activities[currentActivityIndex];
        let correctOrder = [];
        let selectedCards = [];

        // DOMå…ƒç´ 
        const sequenceBoard = document.getElementById('sequenceBoard');
        const activitySelection = document.getElementById('activitySelection');
        const checkButton = document.getElementById('checkButton');
        const resetButton = document.getElementById('resetButton');
        const newActivityButton = document.getElementById('newActivityButton');
        const celebration = document.getElementById('celebration');
        const nextActivityButton = document.getElementById('nextActivityButton');

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            // æ¸…ç©ºåºåˆ—æ¿å’Œæ´»åŠ¨é€‰æ‹©åŒº
            sequenceBoard.innerHTML = '';
            activitySelection.innerHTML = '';
            selectedCards = [];
            
            // è·å–å½“å‰æ´»åŠ¨
            currentActivity = activities[currentActivityIndex];
            
            // åˆ›å»ºæ­£ç¡®é¡ºåºçš„å‰¯æœ¬
            correctOrder = [...currentActivity.steps];
            
            // åˆ›å»ºæ‰“ä¹±é¡ºåºçš„å‰¯æœ¬ç”¨äºæ˜¾ç¤º
            const shuffledSteps = [...currentActivity.steps];
            shuffleArray(shuffledSteps);
            
            // åˆ›å»ºåºåˆ—æ­¥éª¤
            for (let i = 0; i < correctOrder.length; i++) {
                const stepElement = document.createElement('div');
                stepElement.className = 'sequence-step';
                stepElement.innerHTML = `
                    <div class="step-number">${i + 1}</div>
                    <div class="step-content" data-step="${i}" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                `;
                sequenceBoard.appendChild(stepElement);
            }
            
            // åˆ›å»ºæ´»åŠ¨å¡ç‰‡
            shuffledSteps.forEach((step, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'activity-card';
                cardElement.draggable = true;
                cardElement.setAttribute('data-index', index);
                cardElement.innerHTML = `
                    <div class="activity-icon">${step.icon}</div>
                    <div class="activity-label">${step.label}</div>
                `;
                cardElement.addEventListener('dragstart', drag);
                activitySelection.appendChild(cardElement);
            });
            
            // ç¦ç”¨æ£€æŸ¥æŒ‰é’®
            checkButton.disabled = true;
        }

        // æ‰“ä¹±æ•°ç»„é¡ºåº
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        // æ‹–æ‹½å‡½æ•°
        function allowDrop(event) {
            event.preventDefault();
        }

        function drag(event) {
            event.dataTransfer.setData("text", event.target.getAttribute('data-index'));
        }

        function drop(event) {
            event.preventDefault();
            const data = event.dataTransfer.getData("text");
            const draggedElement = document.querySelector(`.activity-card[data-index="${data}"]`);
            
            // å¦‚æœå¡ç‰‡å·²è¢«é€‰æ‹©ï¼Œåˆ™ä¸å…è®¸å†æ¬¡æ”¾ç½®
            if (draggedElement.classList.contains('selected')) {
                return;
            }
            
            // å¦‚æœç›®æ ‡ä½ç½®å·²æœ‰å¡ç‰‡ï¼Œåˆ™ä¸å…è®¸æ”¾ç½®
            const dropTarget = event.target.closest('.step-content');
            if (dropTarget.children.length > 0) {
                return;
            }
            
            // å…‹éš†å¡ç‰‡å¹¶æ”¾ç½®åˆ°ç›®æ ‡ä½ç½®
            const clone = draggedElement.cloneNode(true);
            clone.classList.add('placed');
            clone.draggable = false;
            
            // æ·»åŠ ç§»é™¤åŠŸèƒ½
            clone.addEventListener('click', function() {
                // ç§»é™¤å¡ç‰‡
                this.parentNode.removeChild(this);
                // æ¢å¤åŸå¡ç‰‡å¯ç”¨çŠ¶æ€
                draggedElement.classList.remove('selected');
                // æ›´æ–°é€‰ä¸­å¡ç‰‡æ•°ç»„
                const stepIndex = parseInt(dropTarget.getAttribute('data-step'));
                selectedCards = selectedCards.filter(card => card.step !== stepIndex);
                // æ›´æ–°æ£€æŸ¥æŒ‰é’®çŠ¶æ€
                checkButton.disabled = selectedCards.length !== correctOrder.length;
            });
            
            dropTarget.appendChild(clone);
            
            // æ ‡è®°åŸå¡ç‰‡ä¸ºå·²é€‰æ‹©
            draggedElement.classList.add('selected');
            
            // æ›´æ–°é€‰ä¸­å¡ç‰‡æ•°ç»„
            const stepIndex = parseInt(dropTarget.getAttribute('data-step'));
            selectedCards.push({
                step: stepIndex,
                icon: currentActivity.steps[parseInt(data)].icon,
                label: currentActivity.steps[parseInt(data)].label
            });
            
            // å¦‚æœæ‰€æœ‰æ­¥éª¤éƒ½å·²æ”¾ç½®å¡ç‰‡ï¼Œå¯ç”¨æ£€æŸ¥æŒ‰é’®
            checkButton.disabled = selectedCards.length !== correctOrder.length;
        }

        // æ£€æŸ¥é¡ºåºæ˜¯å¦æ­£ç¡®
        function checkSequence() {
            let isCorrect = true;
            
            // è·å–æ‰€æœ‰å·²æ”¾ç½®çš„å¡ç‰‡
            const placedCards = document.querySelectorAll('.step-content .activity-card');
            
            // æ£€æŸ¥æ¯ä¸ªä½ç½®çš„å¡ç‰‡æ˜¯å¦æ­£ç¡®
            placedCards.forEach((card, index) => {
                const cardIcon = card.querySelector('.activity-icon').textContent;
                const correctIcon = correctOrder[index].icon;
                
                if (cardIcon !== correctIcon) {
                    isCorrect = false;
                    card.style.animation = 'shake 0.5s';
                    setTimeout(() => {
                        card.style.animation = '';
                    }, 500);
                } else {
                    card.style.animation = 'pulse 0.5s';
                    setTimeout(() => {
                        card.style.animation = '';
                    }, 500);
                }
            });
            
            // å¦‚æœå…¨éƒ¨æ­£ç¡®ï¼Œæ˜¾ç¤ºåº†ç¥ç•Œé¢
            if (isCorrect) {
                celebration.style.display = 'flex';
            }
        }

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            // ç§»é™¤æ‰€æœ‰å·²æ”¾ç½®çš„å¡ç‰‡
            const placedCards = document.querySelectorAll('.step-content .activity-card');
            placedCards.forEach(card => card.parentNode.removeChild(card));
            
            // æ¢å¤æ‰€æœ‰åŸå¡ç‰‡å¯ç”¨çŠ¶æ€
            const originalCards = document.querySelectorAll('.activity-selection .activity-card');
            originalCards.forEach(card => card.classList.remove('selected'));
            
            // é‡ç½®é€‰ä¸­å¡ç‰‡æ•°ç»„
            selectedCards = [];
            
            // ç¦ç”¨æ£€æŸ¥æŒ‰é’®
            checkButton.disabled = true;
        }

        // åŠ è½½æ–°æ´»åŠ¨
        function loadNewActivity() {
            // æ›´æ–°æ´»åŠ¨ç´¢å¼•
            currentActivityIndex = (currentActivityIndex + 1) % activities.length;
            
            // åˆå§‹åŒ–æ¸¸æˆ
            initGame();
            
            // éšè—åº†ç¥ç•Œé¢
            celebration.style.display = 'none';
        }

        // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
        checkButton.addEventListener('click', checkSequence);
        resetButton.addEventListener('click', resetGame);
        newActivityButton.addEventListener('click', loadNewActivity);
        nextActivityButton.addEventListener('click', loadNewActivity);

        // æ·»åŠ CSSåŠ¨ç”»
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.1); }
                100% { transform: scale(1); }
            }
        `;
        document.head.appendChild(style);

        // åˆå§‹åŒ–æ¸¸æˆ
        window.onload = function() {
            initGame();
        };
    </script>
</body>
</html>